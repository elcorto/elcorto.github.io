<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation &#8212; pwtools  documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Parsing code output and using containers" href="features/parsing.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Tutorial"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="features/parsing.html" title="Parsing code output and using containers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pwtools  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation</a><ul>
<li><a class="reference internal" href="#add-on-packages-other-required-tools">Add-on packages / other required tools</a><ul>
<li><a class="reference internal" href="#must-have">Must have</a></li>
<li><a class="reference internal" href="#almost-must-have">Almost must have</a></li>
<li><a class="reference internal" href="#suggested">Suggested</a></li>
<li><a class="reference internal" href="#optional">Optional</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-tests">Running tests</a></li>
<li><a class="reference internal" href="#python-versions">Python versions</a></li>
<li><a class="reference internal" href="#compiling-fortran-extensions-and-openmp-notes">Compiling Fortran extensions and OpenMP notes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="features/parsing.html"
                        title="previous chapter">Parsing code output and using containers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial.html"
                        title="next chapter">Tutorial</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/written/install.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>There is no installation script (i.e. <code class="docutils literal"><span class="pre">setup.py</span></code>). Just copy the whole
package somewhere and run <code class="docutils literal"><span class="pre">make</span></code> to compile extensions</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$HOME</span>/python/
$ git clone https://github.com/elcorto/pwtools.git
$ <span class="nb">cd</span> pwtools
$ make
<span class="c1"># ~/.bashrc or ~/.profile</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$HOME</span>/python/pwtools/bin:<span class="nv">$PATH</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="nv">$PYTHONPATH</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$HOME</span>/python:<span class="nv">$PYTHONPATH</span>
<span class="k">else</span>
    <span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$HOME</span>/python
<span class="k">fi</span>
</pre></div>
</div>
<p>Make sure that <code class="docutils literal"><span class="pre">PYTHONPATH</span></code> doesn&#8217;t start with <code class="docutils literal"><span class="pre">:</span></code> and that you don&#8217;t have
<code class="docutils literal"><span class="pre">::</span></code> in it. Otherwise, other modules may try to import <code class="docutils literal"><span class="pre">pwtools/io.py</span></code>
instead of the std lib&#8217;s <code class="docutils literal"><span class="pre">io</span></code>. For example <a class="reference external" href="http://mercurial.selenic.com">Mercurial</a> imports <code class="docutils literal"><span class="pre">tempfile</span></code>, which imports
<code class="docutils literal"><span class="pre">io</span></code>.</p>
<div class="section" id="add-on-packages-other-required-tools">
<h2>Add-on packages / other required tools<a class="headerlink" href="#add-on-packages-other-required-tools" title="Permalink to this headline">¶</a></h2>
<p>Debian:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ sudo apt-get install python-numpy python-scipy python-nose python-dev <span class="se">\</span>
                       python-h5py gfortran python-matplotlib <span class="se">\</span>
                       liblapack-dev
$ sudo apt-get install pip
$ pip install pycifrw
$ pip install pyspglib
</pre></div>
</div>
<div class="section" id="must-have">
<h3>Must have<a class="headerlink" href="#must-have" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.numpy.org">numpy</a></li>
<li><a class="reference external" href="http://www.scipy.org">scipy</a></li>
<li><a class="reference external" href="https://nose.readthedocs.org">nose</a> (for running tests in <code class="docutils literal"><span class="pre">test/</span></code>)</li>
<li>python headers (development files for compiling Fortran extension)</li>
<li>Fortran compiler (e.g. gfortran will do fine)</li>
<li>Blas and Lapack (for <code class="docutils literal"><span class="pre">flib.f90</span></code>)</li>
<li>Unix tools: grep, sed, awk, tail, wc (for <a class="reference internal" href="../generated/api/parse.html#module-pwtools.parse" title="pwtools.parse"><code class="xref py py-mod docutils literal"><span class="pre">parse</span></code></a>); gzip/gunzip (for
<code class="docutils literal"><span class="pre">test/</span></code>). If possible, install mawk, which is much faster than GNU awk. It
will be used automatically if found on your system.</li>
</ul>
</div>
<div class="section" id="almost-must-have">
<h3>Almost must have<a class="headerlink" href="#almost-must-have" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://bitbucket.org/jamesrhester/pycifrw">PyCifRW</a>: For Cif files in  <a class="reference internal" href="../generated/api/pwtools.parse.CifFile.html#pwtools.parse.CifFile" title="pwtools.parse.CifFile"><code class="xref py py-class docutils literal"><span class="pre">CifFile</span></code></a>,
<a class="reference internal" href="../generated/api/pwtools.io.read_cif.html#pwtools.io.read_cif" title="pwtools.io.read_cif"><code class="xref py py-func docutils literal"><span class="pre">read_cif()</span></code></a> and <a class="reference internal" href="../generated/api/pwtools.io.write_cif.html#pwtools.io.write_cif" title="pwtools.io.write_cif"><code class="xref py py-func docutils literal"><span class="pre">write_cif()</span></code></a>. You may get a
DeprecationWarning regarding the <code class="docutils literal"><span class="pre">sets</span></code> module. There is a patched version
from <a class="reference external" href="https://bitbucket.org/elcorto/pwextern-free">pwextern-free</a>, which deals with that. But check the <a class="reference external" href="https://pypi.python.org/pypi/PyCifRW">pip version</a> first.</li>
<li><a class="reference external" href="spglib.sourceforge.net/pyspglib.html">pyspglib</a>: used in <a class="reference internal" href="../generated/api/symmetry.html#module-pwtools.symmetry" title="pwtools.symmetry"><code class="xref py py-mod docutils literal"><span class="pre">symmetry</span></code></a>, also shipped with
<a class="reference external" href="https://bitbucket.org/elcorto/pwextern-free">pwextern-free</a>. Again, check <a class="reference external" href="https://pypi.python.org/pypi/pyspglib">pip</a>.</li>
<li><a class="reference external" href="http://www.h5py.org/">h5py</a>: for some functions in <a class="reference internal" href="../generated/api/io.html#module-pwtools.io" title="pwtools.io"><code class="xref py py-mod docutils literal"><span class="pre">io</span></code></a> currently</li>
</ul>
</div>
<div class="section" id="suggested">
<h3>Suggested<a class="headerlink" href="#suggested" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://matplotlib.org/">matplotlib</a> (<code class="docutils literal"><span class="pre">examples/</span></code>)</li>
<li><a class="reference external" href="http://www.ks.uiuc.edu/Research/vmd/">VMD</a> (<code class="docutils literal"><span class="pre">examples/rpdf/</span></code>, <a class="reference internal" href="../generated/api/pwtools.crys.call_vmd_measure_gofr.html#pwtools.crys.call_vmd_measure_gofr" title="pwtools.crys.call_vmd_measure_gofr"><code class="xref py py-func docutils literal"><span class="pre">call_vmd_measure_gofr()</span></code></a>,
<a class="reference internal" href="../generated/api/pwtools.visualize.view_vmd_axsf.html#pwtools.visualize.view_vmd_axsf" title="pwtools.visualize.view_vmd_axsf"><code class="xref py py-func docutils literal"><span class="pre">view_vmd_axsf()</span></code></a>,
<a class="reference internal" href="../generated/api/pwtools.visualize.view_vmd_xyz.html#pwtools.visualize.view_vmd_xyz" title="pwtools.visualize.view_vmd_xyz"><code class="xref py py-func docutils literal"><span class="pre">view_vmd_xyz()</span></code></a>), must register before download</li>
<li><a class="reference external" href="https://wiki.fysik.dtu.dk/ase">ASE</a>: <a class="reference internal" href="../generated/api/calculators.html#module-pwtools.calculators" title="pwtools.calculators"><code class="xref py py-mod docutils literal"><span class="pre">calculators</span></code></a></li>
</ul>
</div>
<div class="section" id="optional">
<h3>Optional<a class="headerlink" href="#optional" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">fourier.x</span></code> tool from the <a class="reference external" href="http://www.cpmd.org">CPMD</a> contrib sources (for
<code class="docutils literal"><span class="pre">examples/</span></code>). Need to register before download.</li>
<li>eos (for <a class="reference internal" href="../generated/api/eos.html#module-pwtools.eos" title="pwtools.eos"><code class="xref py py-mod docutils literal"><span class="pre">eos</span></code></a>): The tool &#8220;eos&#8221; from the <a class="reference external" href="http://elk.sourceforge.net">Elk</a> code must
be on your path. Note that the executable is assumed to be named &#8220;eos.x&#8221;
instead of the default name &#8220;eos&#8221;. See <a class="reference internal" href="../generated/api/pwtools.eos.ElkEOSFit.html#pwtools.eos.ElkEOSFit" title="pwtools.eos.ElkEOSFit"><code class="xref py py-class docutils literal"><span class="pre">pwtools.eos.ElkEOSFit</span></code></a> for
usage. Can be installed directly from Elk or also <a class="reference external" href="https://bitbucket.org/elcorto/pwextern-free">pwextern-free</a>.</li>
</ul>
<p>The <a class="reference external" href="https://bitbucket.org/elcorto/pwextern-free">pwextern-free</a> package contains add-on tools which we don&#8217;t want / can ship
directly with pwtools, such as eos, PyCifRW and pyspglib, together with an
install script.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><a class="reference internal" href="../generated/api/pwtools.eos.ElkEOSFit.html#pwtools.eos.ElkEOSFit" title="pwtools.eos.ElkEOSFit"><code class="xref py py-class docutils literal"><span class="pre">pwtools.eos.ElkEOSFit</span></code></a> is deprecated now, and so you don&#8217;t
really need the Elk code&#8217;s eos tool anymore. The other two things which come
with <a class="reference external" href="https://bitbucket.org/elcorto/pwextern-free">pwextern-free</a> can be installed by:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pycifrw</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">pyspglib</span>
</pre></div>
</div>
</div>
<p>All imports of optional Python modules will silently fail such that the code
can be used anywhere without errors or annoying warnings. The code parts which
use the dependencies will then fail only if used. And of course the related
tests will fail. That is no problem if you don&#8217;t need the corresponding
functionality.</p>
<p>You can use <code class="docutils literal"><span class="pre">test/check_dependencies.py</span></code> to find out what your system has
installed.</p>
</div>
</div>
<div class="section" id="running-tests">
<h2>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>See tests/README. Actually, all of these are good examples, too!</p>
</div>
<div class="section" id="python-versions">
<h2>Python versions<a class="headerlink" href="#python-versions" title="Permalink to this headline">¶</a></h2>
<p>Developed mostly with Python 2.5..2.7. Should work with all versions from 2.4
on, but not yet 3.x.</p>
</div>
<div class="section" id="compiling-fortran-extensions-and-openmp-notes">
<h2>Compiling Fortran extensions and OpenMP notes<a class="headerlink" href="#compiling-fortran-extensions-and-openmp-notes" title="Permalink to this headline">¶</a></h2>
<p>Use the <code class="docutils literal"><span class="pre">Makefile</span></code>:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ make <span class="nb">help</span>
make gfortran            <span class="c1"># gfortran, default</span>
make gfortran-omp        <span class="c1"># gfortran + OpenMP</span>
make gfortran-mkl        <span class="c1"># gfortran, Intel MKL lapack, set MKL_LIB</span>
make ifort               <span class="c1"># ifort</span>
make ifort-omp           <span class="c1"># ifort + OpenMP</span>
make ifort-mkl           <span class="c1"># ifort, Intel MKL lapack, set MKL_LIB</span>
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">*.so</span></code> and <code class="docutils literal"><span class="pre">*.pyf</span></code> (f2py interface) files.</p>
<p>You need:</p>
<ul class="simple">
<li>numpy</li>
<li>a Fortran compiler</li>
<li>Python headers (Debian/Ubuntu: python-dev)</li>
<li>Lapack (Debian: liblapack3)</li>
</ul>
<p>The module is compiled with f2py (currently part of numpy, tested with numpy
1.1.0 .. 1.7.x).</p>
<p>Instead of letting numpy.distutils pick a compiler + special flags, which is
not trivial and therefore almost never works, it is much easier to simply
define the compiler to use + architecture-specific flags. See F90 and ARCH in
the Makefile.</p>
<p>Also, numpy.distutils has default -03 for fcompiler. <code class="docutils literal"><span class="pre">--f90flags=&quot;-02&quot;</span></code> does NOT
override this. We get <code class="docutils literal"><span class="pre">-O3</span> <span class="pre">-O2</span></code> and a compiler warning. We have to use f2py&#8217;s
<code class="docutils literal"><span class="pre">--opt=</span></code> flag.</p>
<p>On some systems (Debian), you may have:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>/usr/bin/f2py -&gt; f2py2.6
/usr/bin/f2py2.5
/usr/bin/f2py2.6
</pre></div>
</div>
<p>and such. But usually <code class="docutils literal"><span class="pre">F2PY=f2py</span></code> is fine.</p>
<p>We managed to speed up the calculations by sprinkling some OpenMP
pragmas in <code class="docutils literal"><span class="pre">*.f90</span></code>. This works pretty good. If you wanna try, use
<code class="docutils literal"><span class="pre">make</span> <span class="pre">ifort-omp</span></code> or <code class="docutils literal"><span class="pre">make</span> <span class="pre">gfortran-omp</span></code>.</p>
<p>If all went well, _flib.so should be linked to libgomp (or libiomp for ifort).
Check with:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ ldd _flib.so
</pre></div>
</div>
<p>Setting the number of threads:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">2</span>
$ python -c <span class="s2">&quot;import numpy as np; from pwtools.pydos import fvacf; \</span>
<span class="s2">             fvacf(np.random.rand(5000,1000,3))&quot;</span>
</pre></div>
</div>
<p>If this env var is NOT set, then OpenMP uses all available cores (e.g. 4 on a
quad-core box).</p>
<dl class="docutils">
<dt>IMPORTANT:</dt>
<dd>Note that we may have found a f2py bug (see test/test_f2py_flib_openmp.py)
re. OMP_NUM_THREADS. We have a workaround for that in pydos.fvacf().</dd>
</dl>
<p>There is also an optional arg &#8216;nthreads&#8217; to _flib.vacf(). If this is
supplied, then it will override OMP_NUM_THREADS. Currently, this is the
safest way to set the number of threads.</p>
<p>When developing OpenMP code, you may find that code doesn&#8217;t produce correct
results, even if it runs, if OpenMP is used incorrectly :) The test script
<code class="docutils literal"><span class="pre">test/runtests.sh</span></code> calls <cite>make gfortran-omp</cite>, so if code is broken by OpenMP,
all test using the Fortran extensions might fail. To run tests with other
builds, use one  of</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ make gfortran
$ make ifort
$ make ifort-omp
</pre></div>
</div>
<p>and</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nb">test</span>
$ ./runtests.sh --nobuild
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Tutorial"
             >next</a> |</li>
        <li class="right" >
          <a href="features/parsing.html" title="Parsing code output and using containers"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pwtools  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Steve Schmerler.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.
    </div>
  </body>
</html>