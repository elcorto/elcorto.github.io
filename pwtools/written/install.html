
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Installation &#8212; pwtools  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Features" href="features.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>To build the extension modules and install all Python dependencies via pip in
one go, use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pip3 install .
</pre></div>
</div>
<p>or the setuptools “development install” (no copy of files):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pip3 install -e .
</pre></div>
</div>
<p>See the pip and setuptools documentation for all other funny ways to install a
package (using pip or the traditional <code class="docutils literal"><span class="pre">python3</span> <span class="pre">setup.py</span> <span class="pre">install</span> <span class="pre">|</span> <span class="pre">develop</span></code>).</p>
<p>If all dependencies are installed, you may also simply build the extensions and
set <code class="docutils literal"><span class="pre">PYTHONPATH</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd src &amp;&amp; make &amp;&amp; cd ..
$ [ -n &quot;$PYTHONPATH&quot; ] &amp;&amp; pp=$(pwd):$PYTHONPATH || pp=$(pwd)
$ export PYTHONPATH=$pp
</pre></div>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># apt (Debian-ish systems)</span>
<span class="n">python3</span><span class="o">-</span><span class="n">numpy</span>
<span class="n">python3</span><span class="o">-</span><span class="n">scipy</span>
<span class="n">python3</span><span class="o">-</span><span class="n">nose</span>
<span class="n">python3</span><span class="o">-</span><span class="n">dev</span>     <span class="c1"># for compiling extensions</span>
<span class="n">python3</span><span class="o">-</span><span class="n">h5py</span>
<span class="n">python3</span><span class="o">-</span><span class="n">matplotlib</span>
<span class="n">python3</span><span class="o">-</span><span class="n">ase</span>
<span class="n">python3</span><span class="o">-</span><span class="n">numpydoc</span>
<span class="n">python3</span><span class="o">-</span><span class="n">sphinx</span>
<span class="n">gfortran</span>        <span class="c1"># or ifort, see src/Makefile</span>
<span class="n">liblapack</span><span class="o">-</span><span class="n">dev</span>

<span class="c1"># pip</span>
<span class="n">PyCifRW</span>
<span class="n">pyspglib</span>  <span class="c1"># renamed to spglib after v1.8.x, not supported yet</span>
</pre></div>
</div>
<p>You can use <code class="docutils literal"><span class="pre">test/check_dependencies.py</span></code> to find out what your system has
installed.</p>
<p>With <code class="docutils literal"><span class="pre">setup.py</span></code>, all Python dependencies are installed by pip, which might
not be what you want when you are using a system package manager (e.g. apt).
Then, install Debian packages beforehand. <code class="docutils literal"><span class="pre">setup.py</span></code> will detect and use them
if version constraints are fulfilled.</p>
<div class="section" id="optional-dependencies">
<h3>Optional dependencies<a class="headerlink" href="#optional-dependencies" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.ks.uiuc.edu/Research/vmd/">VMD</a> (<code class="docutils literal"><span class="pre">examples/rpdf/</span></code>, <a class="reference internal" href="../generated/api/pwtools.crys.call_vmd_measure_gofr.html#pwtools.crys.call_vmd_measure_gofr" title="pwtools.crys.call_vmd_measure_gofr"><code class="xref py py-func docutils literal"><span class="pre">call_vmd_measure_gofr()</span></code></a>,
<a class="reference internal" href="../generated/api/pwtools.visualize.view_vmd_axsf.html#pwtools.visualize.view_vmd_axsf" title="pwtools.visualize.view_vmd_axsf"><code class="xref py py-func docutils literal"><span class="pre">view_vmd_axsf()</span></code></a>,
<a class="reference internal" href="../generated/api/pwtools.visualize.view_vmd_xyz.html#pwtools.visualize.view_vmd_xyz" title="pwtools.visualize.view_vmd_xyz"><code class="xref py py-func docutils literal"><span class="pre">view_vmd_xyz()</span></code></a>), must register before download</li>
<li>The <code class="docutils literal"><span class="pre">fourier.x</span></code> tool from the <a class="reference external" href="http://www.cpmd.org">CPMD</a> contrib sources (for
<code class="docutils literal"><span class="pre">examples/</span></code>). Need to register before download.</li>
<li>eos (for <a class="reference internal" href="../generated/api/eos.html#module-pwtools.eos" title="pwtools.eos"><code class="xref py py-mod docutils literal"><span class="pre">eos</span></code></a>): The tool “eos” from the <a class="reference external" href="http://elk.sourceforge.net">Elk</a> code must
be on your path. Note that the executable is assumed to be named <code class="docutils literal"><span class="pre">eos.x</span></code>
instead of the default name “eos”. See <a class="reference internal" href="../generated/api/pwtools.eos.ElkEOSFit.html#pwtools.eos.ElkEOSFit" title="pwtools.eos.ElkEOSFit"><code class="xref py py-class docutils literal"><span class="pre">ElkEOSFit</span></code></a> for
usage. Can be installed directly from Elk or <a class="reference external" href="https://bitbucket.org/elcorto/pwextern-free">pwextern-free</a>.</li>
</ul>
<p>The <a class="reference external" href="https://bitbucket.org/elcorto/pwextern-free">pwextern-free</a> package contains add-on tools which we don’t want / can ship
directly with pwtools, such as eos.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">pwextern-free also contains very old versions of PyCifRW and
pyspglib, don’t use those, use pip versions! Also, don’t use the
install.sh script provided there. If needed, only compile eos.x and place it
somewhere in PATH.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="../generated/api/pwtools.eos.ElkEOSFit.html#pwtools.eos.ElkEOSFit" title="pwtools.eos.ElkEOSFit"><code class="xref py py-class docutils literal"><span class="pre">ElkEOSFit</span></code></a> is deprecated now, and so you don’t
really need the Elk code’s eos tool anymore. It was used for generating
refernce EOS fit data once, which is stored in test/files/, but there is no
use of eos.x in pwtools anymore.</p>
</div>
</div>
</div>
<div class="section" id="running-tests">
<h2>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>See test/README. Actually, all of these are good examples, too!</p>
</div>
<div class="section" id="python-versions">
<h2>Python versions<a class="headerlink" href="#python-versions" title="Permalink to this headline">¶</a></h2>
<p>Only Python3, tested: Python 3.6</p>
<p>The package was developed mostly with Python 2.5..2.7 and ported using 2to3.</p>
</div>
<div class="section" id="compiling-fortran-extensions-and-openmp-notes">
<h2>Compiling Fortran extensions and OpenMP notes<a class="headerlink" href="#compiling-fortran-extensions-and-openmp-notes" title="Permalink to this headline">¶</a></h2>
<p>Use <code class="docutils literal"><span class="pre">src/Makefile</span></code>:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ make <span class="nb">help</span>
make gfortran            <span class="c1"># gfortran, default</span>
make gfortran-omp        <span class="c1"># gfortran + OpenMP</span>
make gfortran-mkl        <span class="c1"># gfortran, Intel MKL lapack, set MKL_LIB</span>
make ifort               <span class="c1"># ifort</span>
make ifort-omp           <span class="c1"># ifort + OpenMP</span>
make ifort-mkl           <span class="c1"># ifort, Intel MKL lapack, set MKL_LIB</span>
</pre></div>
</div>
<p>Generates <code class="docutils literal"><span class="pre">*.so</span></code> and <code class="docutils literal"><span class="pre">*.pyf</span></code> (f2py interface) files.</p>
<p>You need:</p>
<ul class="simple">
<li>numpy for f2py</li>
<li>a Fortran compiler</li>
<li>Python headers (Debian/Ubuntu: python-dev)</li>
<li>Lapack (Debian: liblapack3)</li>
</ul>
<p>The module is compiled with f2py (currently part of numpy, tested with numpy
1.1.0 .. 1.13.x).</p>
<div class="section" id="compiler-f2py">
<h3>Compiler / f2py<a class="headerlink" href="#compiler-f2py" title="Permalink to this headline">¶</a></h3>
<p>Instead of letting numpy.distutils pick a compiler + special flags, which is
not trivial and therefore almost never works, it is much easier to simply
define the compiler to use + architecture-specific flags. See F90 and ARCH in
the Makefile.</p>
<p>Also, numpy.distutils has default -03 for fcompiler. <code class="docutils literal"><span class="pre">--f90flags=&quot;-02&quot;</span></code> does NOT
override this. We get <code class="docutils literal"><span class="pre">-O3</span> <span class="pre">-O2</span></code> and a compiler warning. We have to use f2py’s
<code class="docutils literal"><span class="pre">--opt=</span></code> flag.</p>
<p>On some systems (Debian), you may have:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>/usr/bin/f2py -&gt; f2py2.6
/usr/bin/f2py2.5
/usr/bin/f2py2.6
</pre></div>
</div>
<p>and such. But usually <code class="docutils literal"><span class="pre">F2PY=f2py</span></code> is fine.</p>
</div>
<div class="section" id="openmp">
<h3>OpenMP<a class="headerlink" href="#openmp" title="Permalink to this headline">¶</a></h3>
<p>We managed to speed up the calculations by sprinkling some OpenMP
pragmas in <code class="docutils literal"><span class="pre">*.f90</span></code>. This works pretty good. If you wanna try, use
<code class="docutils literal"><span class="pre">make</span> <span class="pre">ifort-omp</span></code> or <code class="docutils literal"><span class="pre">make</span> <span class="pre">gfortran-omp</span></code>.</p>
<p>If all went well, <code class="docutils literal"><span class="pre">_flib.so</span></code> should be linked to <code class="docutils literal"><span class="pre">libgomp</span></code> (or <code class="docutils literal"><span class="pre">libiomp</span></code>
for <code class="docutils literal"><span class="pre">ifort</span></code>). Check with:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ ldd _flib.so
</pre></div>
</div>
<p>Setting the number of threads:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">2</span>
$ python -c <span class="s2">&quot;import numpy as np; from pwtools.pydos import fvacf; \</span>
<span class="s2">             fvacf(np.random.rand(5000,1000,3))&quot;</span>
</pre></div>
</div>
<p>If this env var is NOT set, then OpenMP uses all available cores (e.g. 4 on a
quad-core box).</p>
<dl class="docutils">
<dt>IMPORTANT:</dt>
<dd>Note that we may have found a f2py bug (see test/test_f2py_flib_openmp.py)
re. OMP_NUM_THREADS. We have a workaround for that in pydos.fvacf().</dd>
</dl>
<p>There is also an optional arg ‘nthreads’ to _flib.vacf(). If this is
supplied, then it will override OMP_NUM_THREADS. Currently, this is the
safest way to set the number of threads.</p>
</div>
<div class="section" id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h3>
<p>When developing OpenMP code, you may find that code doesn’t produce correct
results, even if it runs, if OpenMP is used incorrectly :) The test script
<code class="docutils literal"><span class="pre">test/runtests.sh</span></code> calls <cite>make gfortran-omp</cite>, so if code is broken by OpenMP,
all test using the Fortran extensions might fail. To run tests with other
builds, use one of</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ make gfortran
$ make ifort
$ make ifort-omp
</pre></div>
</div>
<p>and</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nb">test</span>
$ ./runtests.sh --nobuild
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
    <h1 class="logo logo-name">pwtools</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=elcorto&repo=pwtools&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../generated/api/index.html">API Reference</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-versions">Python versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compiling-fortran-extensions-and-openmp-notes">Compiling Fortran extensions and OpenMP notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="background/index.html">Background, details, special topics</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">&lt;no title&gt;</a><ul>
      <li>Previous: <a href="features.html" title="previous chapter">Features</a></li>
      <li>Next: <a href="tutorial.html" title="next chapter">Tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Steve Schmerler.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/written/install.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>